<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Friendsgiving 2025 RSVP</title>
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- ğŸ”¥ Fakie Animation -->
  <style>
    @keyframes fakieShake {
      0% { transform: rotate(0deg); }
      25% { transform: rotate(-10deg); }
      50% { transform: rotate(10deg); }
      75% { transform: rotate(-10deg); }
      100% { transform: rotate(0deg); }
    }
    .animate-fakie {
      animation: fakieShake 0.5s ease-in-out infinite;
    }
  </style>
</head>

<body class="bg-orange-50 flex justify-center items-center min-h-screen px-4 py-8">

  <div class="bg-white rounded-2xl shadow-2xl p-6 max-w-xl w-full">
    
    <!-- Banner Image -->
    <img src="friendsgiving-banner.png" alt="Friendsgiving Banner" class="rounded-xl mb-6 w-full shadow"/>

    <!-- Header -->
    <h1 class="text-3xl font-extrabold text-center text-amber-700 mb-2">
      Sayar G myr's Friendsgiving
    </h1>

    <!-- Date & Time -->
    <div class="bg-amber-50 border border-amber-200 rounded-xl p-4 mb-4 text-center">
      <p class="text-sm text-gray-600 font-medium mb-1">ğŸ“… Date & Time</p>
      <p class="text-lg font-semibold text-amber-800">
        Friday, November 28, 2025 Â· 6:00 PM
      </p>
    </div>

    <ul class="text-gray-700 text-sm mb-4 list-disc list-inside">
      <li>Food, snacks, desserts, and drinks ğŸ§ğŸ·</li>
      <li>Board games ğŸ˜ˆ</li>
    </ul>

    <!-- RSVP Form -->
    <form
      action="https://docs.google.com/forms/d/e/1FAIpQLSeMb_wr68LOkmCSrlATYWqnp4GuaD26KDd-91Mi8ejiwlL_MQ/formResponse"
      method="POST"
      id="rsvpForm"
      class="space-y-4"
      onsubmit="return handleSubmit(event)">

      <!-- Name -->
      <input
        type="text"
        name="entry.145399973"
        placeholder="Your Name"
        required
        class="w-full p-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-amber-400"
      />
      <p id="errorName" class="text-red-500 text-sm hidden">Please enter your name.</p>

      <!-- Email -->
      <input
        type="email"
        name="entry.1557240136"
        placeholder="Your Email"
        required
        class="w-full p-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-amber-400"
      />
      <p id="errorEmail" class="text-red-500 text-sm hidden">Please enter a valid email.</p>

      <!-- Attendance -->
      <select
        name="entry.1494175785"
        id="attendance"
        required
        class="w-full p-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-amber-400"
        onchange="toggleFakie(this.value)"
      >
        <option value="">Will you attend?</option>
        <option value="Yes, Iâ€™ll be there ğŸ‰">Yes, Iâ€™ll be there ğŸ‰</option>
        <option value="No, I canâ€™t make it ğŸ˜¢">No, I canâ€™t make it ğŸ˜¢</option>
      </select>
      <p id="errorAttendance" class="text-red-500 text-sm hidden">Please select attendance status.</p>

      <!-- Number of Guests -->
      <input
        type="number"
        min="1"
        max="10"
        name="entry.627077154"
        placeholder="How many people including you? (optional)"
        class="w-full p-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-amber-400"
      />

      <!-- FAKIE message for No -->
      <div
        id="fakieMessage"
        class="hidden text-red-700 text-6xl sm:text-7xl md:text-8xl font-extrabold text-center mt-8 animate-fakie"
      >
        m lar yin lee plğŸ–•
      </div>

      <!-- Submit Button -->
      <button
        type="submit"
        class="w-full bg-amber-500 hover:bg-amber-600 text-white font-semibold py-3 rounded-xl transition"
      >
        Submit RSVP
      </button>
    </form>

    <!-- Thank-you message -->
    <div id="thankYou" class="hidden mt-4 text-center text-green-700 font-semibold">
      Thank you! Your RSVP has been recorded. ğŸ¦ƒ
    </div>

    <!-- ğŸ§ Menu Section -->
    <div class="mt-8">
      <h2 class="text-lg font-semibold text-gray-800 mb-2">ğŸ§ Menu</h2>
      <p class="text-gray-600 mb-3">
        Hereâ€™s a peek at what weâ€™ll have for Friendsgiving â€” come hungry. ğŸ˜Œ
      </p>
      <img
        src="friendsgiving-menu.png"
        alt="Friendsgiving Menu"
        class="w-full rounded-xl shadow mb-3"
      />
      <ul class="text-gray-700 text-sm list-disc list-inside">
        <li>Menu is subject to small changes on the day ğŸŒŸ</li>
        <li>Total expenses will be split among everyone.</li>
      </ul>
    </div>

    <!-- ğŸ‘¥ Guest List Section (AUTO) -->
    <div class="mt-8">
      <h2 class="text-lg font-semibold text-gray-800 mb-2">ğŸ‘¥ Guest List</h2>
      <p class="text-gray-600 mb-3 text-sm">
        This list updates automatically based on RSVPs from the form.
      </p>

      <div id="guestSummary" class="text-sm text-amber-800 font-medium mb-2 hidden">
        <!-- Filled by JS -->
      </div>

      <div id="guestListWrapper" class="bg-amber-50 border border-amber-200 rounded-xl p-4">
        <p id="guestLoading" class="text-gray-500 text-sm">Loading guest list...</p>
        <ul id="guestList" class="text-gray-800 text-sm space-y-1 list-disc list-inside"></ul>
      </div>
    </div>

    <!-- Location -->
    <div class="mt-8">
      <h2 class="text-lg font-semibold text-gray-800 mb-2">ğŸ“ Location</h2>
      <p class="text-gray-600 mb-2">
        299 Whitwell St, Quincy, MA 02169
      </p>
      <iframe
        src="https://www.google.com/maps?q=299+Whitwell+St,+Quincy,+MA+02169&output=embed"
        width="100%"
        height="250"
        style="border:0;"
        allowfullscreen=""
        loading="lazy"
        class="rounded-xl"
      ></iframe>
    </div>

  </div>

  <!-- Form + Guest List Script -->
  <script>
    // ğŸ”— Paste your Apps Script web app URL here:
    const GUEST_API_URL = 'https://script.google.com/macros/s/AKfycbzNxKuMb-kwvIuE2cNqZ02NDo0FtWXl9y4yhzi5jJ9tshRuWEiDcfVKjZKgWumG5ChT/exec';

    function toggleFakie(value) {
      const fakie = document.getElementById('fakieMessage');
      if (value.startsWith("No")) {
        fakie.classList.remove('hidden');
      } else {
        fakie.classList.add('hidden');
      }
    }

    function validateForm() {
      const name = document.querySelector('input[name="entry.145399973"]');
      const email = document.querySelector('input[name="entry.1557240136"]');
      const attendanceValue = document.getElementById('attendance').value;

      const errorName = document.getElementById('errorName');
      const errorEmail = document.getElementById('errorEmail');
      const errorAttendance = document.getElementById('errorAttendance');

      // Reset all errors
      errorName.classList.add('hidden');
      errorEmail.classList.add('hidden');
      errorAttendance.classList.add('hidden');

      let valid = true;

      if (name.value.trim() === "") {
        errorName.classList.remove('hidden');
        valid = false;
      }

      if (email.value.trim() === "") {
        errorEmail.classList.remove('hidden');
        valid = false;
      }

      if (attendanceValue === "") {
        errorAttendance.classList.remove('hidden');
        valid = false;
      }

      return valid;
    }

    function handleSubmit(event) {
      if (!validateForm()) {
        return false;
      }

      event.preventDefault(); // stop normal submit

      const form = event.target;
      const formData = new FormData(form);

      fetch(form.action, {
        method: 'POST',
        mode: 'no-cors',
        body: formData
      }).then(() => {
        document.getElementById('rsvpForm').classList.add('hidden');
        document.getElementById('thankYou').classList.remove('hidden');

        // Give Google a second to write to the sheet, then reload guests
        setTimeout(loadGuestList, 1500);
      }).catch(() => {
        alert("Something went wrong, please try again later.");
      });

      return false;
    }

    async function loadGuestList() {
      const guestList = document.getElementById('guestList');
      const loading = document.getElementById('guestLoading');
      const summary = document.getElementById('guestSummary');

      if (!GUEST_API_URL || GUEST_API_URL.includes('https://script.google.com/macros/s/AKfycbzNxKuMb-kwvIuE2cNqZ02NDo0FtWXl9y4yhzi5jJ9tshRuWEiDcfVKjZKgWumG5ChT/exec')) {
        loading.textContent = "Guest list API URL not set yet.";
        return;
      }

      loading.textContent = "Loading guest list...";

      try {
        const res = await fetch(https://script.google.com/macros/s/AKfycbzNxKuMb-kwvIuE2cNqZ02NDo0FtWXl9y4yhzi5jJ9tshRuWEiDcfVKjZKgWumG5ChT/exec);
        const data = await res.json();

        guestList.innerHTML = '';

        if (!data.guests || data.guests.length === 0) {
          loading.textContent = "No RSVPs yet. Be the first to reply!";
          summary.classList.add('hidden');
          return;
        }

        loading.classList.add('hidden');

        data.guests.forEach(g => {
          const li = document.createElement('li');
          const statusEmoji = g.attendance.startsWith('Yes')
            ? 'âœ…'
            : g.attendance.startsWith('No')
              ? 'âŒ'
              : 'â“';

          const countText = g.count && g.count > 1
            ? ` (x${g.count} people)`
            : '';

          li.textContent = `${statusEmoji} ${g.name} â€“ ${g.attendance}${countText}`;
          guestList.appendChild(li);
        });

        summary.textContent = `Total people expected (including guests): ${data.totalPeople}`;
        summary.classList.remove('hidden');

      } catch (err) {
        console.error(err);
        loading.textContent = "Couldnâ€™t load guest list. Please try again later.";
      }
    }

    document.addEventListener('DOMContentLoaded', loadGuestList);
  </script>

</body>
</html>
